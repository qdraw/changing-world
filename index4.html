<!DOCTYPE html>
<meta charset="utf-8">
<head>
<link rel="stylesheet" type="text/css" href="css/reset.css">
<link rel="stylesheet" type="text/css" href="css/style.css">


</head>
<body>



<div id="canvas"></div>
<div class="content">
	Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec id quam volutpat, finibus nibh ac, commodo ipsum. Curabitur at ligula nisl. Etiam consectetur tincidunt libero vitae suscipit. Nulla mollis rutrum fermentum. Sed vel pellentesque urna, et blandit nunc. Pellentesque turpis nunc, bibendum ut ligula id, efficitur tincidunt odio. Nam eu orci dignissim, varius sem eu, lobortis libero. Fusce ipsum leo, congue id nibh at, porttitor consectetur ante. Vivamus sed arcu vitae justo viverra rutrum et sit amet ex. Phasellus elementum eleifend odio, tempus maximus nibh dictum eget. Proin venenatis ultrices dolor, sit amet efficitur lacus convallis interdum. Praesent nulla nulla, tincidunt quis varius a, hendrerit sed nunc. Suspendisse in velit ut sapien accumsan tristique nec laoreet velit.

	Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Cras ac ultricies velit, in malesuada enim. Nam eget varius turpis, eget interdum tortor. Fusce quis lacus a lectus congue facilisis sit amet eget libero. Nulla facilisi. Donec ultrices purus nec molestie accumsan. Aliquam vitae est volutpat, ornare enim ac, viverra nisi. Quisque vitae eros sodales, interdum mauris eget, tempus lorem. Curabitur condimentum sodales magna, id dapibus ex efficitur id. Pellentesque mattis sed tellus sed efficitur. Nullam in efficitur erat. Nulla dictum malesuada odio vulputate lacinia. Sed et dolor sit amet purus molestie maximus in ac elit. Maecenas sed lacinia mi, a ornare augue. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Vivamus vel massa id mi auctor rhoncus. 

</div>

<script type="text/javascript" src="js/tabletop.js"></script>


<script type="text/javascript">


    var data = {};


    // window.onload = function() { init() };

    var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/1RKekJPcE5OazkWOWatk04a34HUhOO1nRqIhVaOTtJPk/pubhtml';

    function init() {
        Tabletop.init( { key: public_spreadsheet_url,
            callback: showInfo,
            simpleSheet: true } )
    }

    function showInfo(content, tabletop) {
        // window.requestAnimationFrame(draw);

        console.log(content);

		Object.keys(content).forEach(function(key) {

			data[content[key].code] = new Object();
			// data[content[key].code]["img"] = new Image();
			// data[content[key].code]["img"]["src"] = "images/countries/" + content[key].code + ".svg";

			var image = document.createElement("div");
			// image.setAttribute("src", "images/countries/" + content[key].code + ".svg");
			image.setAttribute("id", content[key].code);


				var xhr = new XMLHttpRequest();
				xhr.onreadystatechange = function() {
				    if (xhr.readyState == 4) {
						var response = xhr.responseText;
						

						var svgWidth = response.match(/(width=["'])[0-9]*.px+(["'])/g)
						var svgHeight = response.match(/(height=["'])[0-9]*.px+(["'])/g)

						if (svgWidth != null || svgHeight != null) {
							svgWidth = svgWidth[0].replaceAll('width="', "");
							svgWidth = Number(svgWidth.replaceAll('px"', ""));
							console.log(svgWidth);

							svgHeight = svgHeight[0].replaceAll('height="', "");
							svgHeight = Number(svgHeight.replaceAll('px"', ""));
							console.log(svgHeight);

							var ratio = svgWidth / svgHeight;
							data[content[key].code]["r"] = ratio;

						}



						


						var response = response.replaceAll('#CCCCCC', '#c62c2c');

						var encoded = window.btoa(response);
						image.setAttribute("style", "background-image: url('data:image/svg+xml;base64," + encoded + "')");
				    }
				}
				xhr.open('GET', "images/countries/" + content[key].code + ".svg", true);
				xhr.send(null);


			
			document.getElementById("canvas").appendChild(image);


			data[content[key].code]["x"] = content[key]["x1"];
			data[content[key].code]["y"] = content[key]["y1"];
			data[content[key].code]["s"] = content[key]["s1"];

		});



		requestAnimationFrame(function() {
		    draw(data,content);
		});

    }

    function draw(data,content) {


		Object.keys(content).forEach(function(key) {

			if (data[content[key].code]["x"] < content[key]["x2"]) {
				// console.log("x " + content[key].code + " " + data[content[key].code]["x"]);
				data[content[key].code]["x"]++;
			}
			else {
				data[content[key].code]["x"] = content[key]["x2"];
			}

			if (data[content[key].code]["y"] < content[key]["y2"]) {
				// console.log("y " +data[content[key].code]["y"]);
				data[content[key].code]["y"]++;
			}
			else {
				data[content[key].code]["y"] = content[key]["y2"];
				// console.log(data[content[key].code]["y"])
			}

			// s
			if (data[content[key].code]["s"] < content[key]["s2"]) {
				// console.log("y " +data[content[key].code]["y"]);
				data[content[key].code]["s"]++;
			}
			else {
				data[content[key].code]["s"] = content[key]["s2"];
				// console.log(data[content[key].code]["y"])
			}



			document.getElementById(content[key].code).style.width = (data[content[key].code]["s"] * data[content[key].code]["r"]) + "vh";
			document.getElementById(content[key].code).style.height = data[content[key].code]["s"] + "vh";



			// document.getElementById(content[key].code).style.height = data[content[key].code]["s"] + "vh";

			document.getElementById(content[key].code).style.left = data[content[key].code]["x"] + "vw";
			document.getElementById(content[key].code).style.top = data[content[key].code]["y"] + "vh";


			// document.getElementById(content[key].code).style.width = data[content[key].code]["s"];
			// document.getElementById(content[key].code).style.height = data[content[key].code]["s"];

			// document.querySelector("#canvas #" + content[key].code).style.left = data[content[key].code]["x"] + " vw";
			// document.querySelector("#canvas #" + content[key].code).style.top = data[content[key].code]["y"] + " vw";


			// ctx.drawImage(data[content[key].code]["img"],data[content[key].code]["x"],data[content[key].code]["y"],data[content[key].code]["s"],data[content[key].code]["s"])

		});

		requestAnimationFrame(function() {
		    draw(data,content);
		});

    }

    function map( x,  in_min,  in_max,  out_min,  out_max){
    	return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
    }

	String.prototype.replaceAll = function( token, newToken, ignoreCase ) {
	    var _token;
	    var str = this + "";
	    var i = -1;

	    if ( typeof token === "string" ) {

	        if ( ignoreCase ) {

	            _token = token.toLowerCase();

	            while( (
	                i = str.toLowerCase().indexOf(
	                    token, i >= 0 ? i + newToken.length : 0
	                ) ) !== -1
	            ) {
	                str = str.substring( 0, i ) +
	                    newToken +
	                    str.substring( i + token.length );
	            }

	        } else {
	            return this.split( token ).join( newToken );
	        }

	    }
	return str;
	};

    init();
</script>



</body>
</html>